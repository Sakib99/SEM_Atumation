# SEM AUTOMATION


### The SEM pipeline is made up of the following steps:

1. SEM SQL Runner
2. SEM BQ Target Runner
3. SEM BQ Control Runner
4. SEM Match Runner
5. SEM Historical Automation Runner 
6. SEM Calculate Runner
7. SEM Historical Automation Runner

## Steps for running the pipeline:
  

## Running Options:
#### The Pipeline could be run into two ways:
  1. Argo Pipeline (Synced With Google CloudBuild)
  2. Manual Run From CMD

### 1. Argo pipeline
Under the Argo Workflow Templates,  click on the sem-pipeline and then click submit button. It would lead to the page containing the input fields listed in the below section: 

###  Argo pipeline Inputs
   * fw-start-date : The start date (monday) of the week
   * fw-end-date : The end date (Sunday) of the week
   * dataset_name : Any dataset name in the GCP project
   * dev : Development environment either dev or prod.

### 2. Manual Run
   * Download this repository and check into the src folder 
   * Set Up a Python 3.7 version environment
   * Activate the environment if using conda
   * Run pip install -r requirements.txt
   * Make a file Credentials folder and paste the JSON formatted credential into it
   * Make the path GOOGLE_APPLICATION_CREDENTIALS to the 
   JSON file.
   * Add the ENV path to the “env”
   * Run the steps sequentially listed on Section 1 and the corresponding python files listed on the src folder with parameters start-date(monday), end-date(sunday) , dataset and the environment. 
                        
### Example Running Steps Under Manual Run
1. python3 sem_sql_runner.py 2022-03-21 2022-03-27 DX_dev dev
2. python3 sem_bq_target_runner.py 2022-03-21 2022-03-27 DX_dev dev
3. python3 sem_bq_control_runner.py 2022-03-21 2022-03-27 DX_dev dev
4. python3 sem_match_unner.py 2022-03-21 2022-03-27 DX_dev dev
5. python3 sem_historical_automation.py 2022-03-21 2022-03-27 DX_dev dev
6. python3 sem_calculate.py 2022-03-21 2022-03-27 DX_dev dev
7. python3 sem_insert.py 2022-03-21 2022-03-27 DX_dev dev

              
### Docker
1. [dockerfiles](dockerfiles): dockerfile

### Argo
1. [deployment/sem-deployment-shared.yml](deployment/sem-deployment-shared.yml): Workflow template for the main Sem pipeline
2. [deployment/sem-pipeline.yaml](deployment/sem-pipeline.yaml): Workflow templates to that can be used to build pipeline

##  CI/CD pipeline
  The git repo of the “sem_dis_automation” branch is synced with the google   cloud build trigger “Sem Trigger”. In case of creating a new trigger, make a branch and add it to the new trigger. The trigger is being generated by the git push command.
  Cloudbuild file: The cloudbuild.yml is used with the docker files in the dockerfiles directory.

